<div class="container mx-auto p-4">
  <h1 class="text-2xl md:text-3xl font-bold mb-6 text-gray-800">Dashboard de Tasas de Cambio</h1>

  <!-- Grid container para las tres tablas principales -->
  <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-5">
    <!-- Panel de Comparativa General -->
    <div class="w-full">
      <mat-card class="min-h-full shadow-md !p-4 md:!p-6">
        <mat-card-header class="!p-0">
          <div class="flex justify-between items-center w-full mb-4">
            <mat-card-title class="text-sm md:text-">Comparativa</mat-card-title>
          </div>
        </mat-card-header>
        <mat-card-content class="!p-0">
          <div class="w-full">
            <table mat-table [dataSource]="combinedRates" class="w-full !bg-transparent">

              <!-- Columnas de la tabla -->
              <ng-container matColumnDef="exchange">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-semibold bg-gray-50 !text-sm md:!text-sm">Plataforma</th>
                <td mat-cell *matCellDef="let element" class="!border-gray-300 py-3 !text-sm md:!text-sm">{{ element.exchange }}</td>
              </ng-container>


              <ng-container matColumnDef="monitor_rate">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-semibold bg-gray-50 !text-sm md:!text-sm">Monitor</th>
                <td mat-cell *matCellDef="let element" class="!border-gray-300 py-3 !text-sm md:!text-sm">
                  {{ element.monitor_rate | number : "1.2-2" }}
                </td>
              </ng-container>



              <ng-container matColumnDef="exchange_rate">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-semibold bg-gray-50 !text-sm md:!text-sm">Exchange</th>
                <td mat-cell *matCellDef="let element" class="!border-gray-300 py-3 !text-sm md:!text-sm">
                  {{ element.exchange_rate | number : "1.2-2" }}
                </td>
              </ng-container>

              <ng-container matColumnDef="diferencia">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-bold bg-gray-50 !text-sm md:!text-sm">Diff</th>
                <td mat-cell *matCellDef="let element"
                    [ngClass]="{
                      'text-emerald-500': element.diferencia > 0,
                      'text-rose-500': element.diferencia < 0,
                      'text-gray-500': element.diferencia === 0
                    }"
                    class="py-3 !border-gray-300 !text-sm md:!text-sm">
                  <b style="white-space: nowrap;" class="font-extrabold">{{ element.diferencia > 0 ? "▲" : (element.diferencia < 0 ? "▼" : "=") }}
                    {{ element.diferencia | number : "1.2-2" }} / {{ element.diferencia_porcentaje | number : "1.2-2" }}%
                  </b>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"
                  class="hover:bg-gray-200 transition-colors !h-10"
                  [ngClass]="{
                    '!bg-gray-300': row.exchange === 'Total'
                  }">
              </tr>
            </table>
          </div>
        </mat-card-content>
        <div class="flex flex-col sm:flex-row justify-between gap-2 mt-5 text-xs md:text-sm" *ngIf="combinedRates.length > 0">
          <div class="text-gray-600">Monitor: {{ combinedRates[0].last_update_monitor.format('dddd HH:mm') }}</div>
          <div class="text-gray-600">Exchange: {{ combinedRates[0].last_update_exchange.format('dddd HH:mm') }}</div>
          <div class="text-gray-500">Diferencia: {{ combinedRates[0].tiempo_diferencia }}</div>
        </div>
      </mat-card>
    </div>

    <!-- Monitor Rates -->
    <div class="w-full">
      <mat-card class="min-h-full shadow-md !p-4 md:!p-6">
        <mat-card-header class="!p-0">
          <div class="flex justify-between items-start w-full mb-4">
            <mat-card-title>
              <div>Monitor Rates</div>
              <div class="text-sm md:text-sm">{{monitorComparisons[monitorComparisons.length - 1].last_update.format('dddd HH:mm')}}</div>
            </mat-card-title>
            <div class="text-base">
              <div class="font-bold py-2 px-3 rounded-md bg-blue-950 text-white">
                Bs. {{monitorComparisons[monitorComparisons.length - 1].current_rate | number : "1.2-2"}}
              </div>
            </div>
          </div>
        </mat-card-header>
        <mat-card-content class="!p-0">
          <div class="w-full">
            <table mat-table [dataSource]="monitorComparisons" class="w-full !bg-transparent">
              <ng-container matColumnDef="exchange">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-semibold bg-gray-50 !text-sm md:!text-sm">Plataforma</th>
                <td mat-cell *matCellDef="let element" class="!border-gray-300 py-3 !text-sm md:!text-sm">{{ element.exchange }}</td>
              </ng-container>

              <ng-container matColumnDef="current_rate">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-semibold bg-gray-50 !text-sm md:!text-sm">Actual</th>
                <td mat-cell *matCellDef="let element" class="!border-gray-300 py-3 !text-sm md:!text-sm">
                  {{ element.current_rate | number : "1.2-2" }}
                </td>
              </ng-container>

              <ng-container matColumnDef="previous_rate">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-semibold bg-gray-50 !text-sm md:!text-sm">Anterior</th>
                <td mat-cell *matCellDef="let element" class="!border-gray-300 py-3 !text-sm md:!text-sm">
                  {{ element.previous_rate | number : "1.2-2" }}
                </td>
              </ng-container>

              <ng-container matColumnDef="diferencia">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-bold bg-gray-50 !text-sm md:!text-sm">Diff</th>
                <td mat-cell *matCellDef="let element"
                    [ngClass]="{
                      'text-emerald-500': element.diferencia > 0,
                      'text-rose-500': element.diferencia < 0,
                      'text-gray-500': element.diferencia === 0
                    }"
                    class="py-3 !border-gray-300 !text-sm md:!text-sm">
                  <b style="white-space: nowrap;">{{ element.diferencia > 0 ? "▲" : (element.diferencia < 0 ? "▼" : "=") }}
                    {{ element.diferencia | number : "1.2-2" }} / {{ element.diferencia_porcentaje | number : "1.2-2" }}%
                  </b>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="monitorColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: monitorColumns"
                  class="hover:bg-gray-200 transition-colors !h-10"
                  [ngClass]="{
                    '!bg-gray-300': row.exchange === 'Total'
                  }">
              </tr>
            </table>
          </div>
        </mat-card-content>
        <div class="flex justify-end gap-2 mt-5 text-xs md:text-sm" *ngIf="monitorComparisons.length > 0">
          <div class="text-gray-600">Última actualización: {{ monitorComparisons[0].last_update.format('dddd HH:mm') }}</div>
        </div>
      </mat-card>
    </div>

    <!-- Exchange Rates -->
    <div class="w-full">
      <mat-card class="min-h-full shadow-md !p-4 md:!p-6">

        <mat-card-header class="!p-0">
          <div class="flex justify-between items-start w-full mb-4">
            <mat-card-title>
              <div>Exchange Rates</div>
              <div class="text-sm md:text-sm">{{exchangeComparisons[exchangeComparisons.length - 1].last_update.format('dddd HH:mm')}}</div>
            </mat-card-title>
            <div class="text-base">
              <div class="font-bold py-2 px-3 rounded-md bg-blue-950 text-white">
                Bs. {{exchangeComparisons[exchangeComparisons.length - 1].current_rate | number : "1.2-2"}}
              </div>
            </div>
          </div>
        </mat-card-header>
        <mat-card-content class="!p-0">
          <div class="w-full">
            <table mat-table [dataSource]="exchangeComparisons" class="w-full !bg-transparent">
              <ng-container matColumnDef="exchange">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-semibold bg-gray-50 !text-sm md:!text-sm">Exchange</th>
                <td mat-cell *matCellDef="let element" class="!border-gray-300 py-3 !text-sm md:!text-sm">{{ element.exchange }}</td>
              </ng-container>

              <ng-container matColumnDef="current_rate">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-semibold bg-gray-50 !text-sm md:!text-sm">Tasa Actual</th>
                <td mat-cell *matCellDef="let element" class="!border-gray-300 py-3 !text-sm md:!text-sm">
                  {{ element.current_rate | number : "1.2-2" }}
                </td>
              </ng-container>

              <ng-container matColumnDef="previous_rate">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-semibold bg-gray-50 !text-sm md:!text-sm">Tasa Anterior</th>
                <td mat-cell *matCellDef="let element" class="!border-gray-300 py-3 !text-sm md:!text-sm">
                  {{ element.previous_rate | number : "1.2-2" }}
                </td>
              </ng-container>

              <ng-container matColumnDef="diferencia">
                <th mat-header-cell *matHeaderCellDef class="!border-gray-300 font-bold bg-gray-50 !text-sm md:!text-sm">Diferencia VES</th>
                <td mat-cell *matCellDef="let element"
                    [ngClass]="{
                      'text-emerald-500': element.diferencia > 0,
                      'text-rose-500': element.diferencia < 0,
                      'text-gray-500': element.diferencia === 0
                    }"
                    class="py-3 !border-gray-300 !text-sm md:!text-sm">
                  <b style="white-space: nowrap;">{{ element.diferencia > 0 ? "▲" : (element.diferencia < 0 ? "▼" : "=") }}
                    {{ element.diferencia | number : "1.2-2" }} / {{ element.diferencia_porcentaje | number : "1.2-2" }}%
                  </b>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="exchangeColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: exchangeColumns"
                  class="hover:bg-gray-200 transition-colors !h-10"
                  [ngClass]="{
                    '!bg-gray-300': row.exchange === 'Total'
                  }">
              </tr>
            </table>
          </div>
        </mat-card-content>
        <div class="flex justify-end gap-2 mt-5 text-xs md:text-sm" *ngIf="exchangeComparisons.length > 0">
          <div class="text-gray-600">Última actualización: {{ exchangeComparisons[0].last_update.format('dddd HH:mm') }}</div>
        </div>
      </mat-card>
    </div>
  </div>


</div>
